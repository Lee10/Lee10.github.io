<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Optional使用介绍 | 月·痕</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Optional使用介绍</h1><a id="logo" href="/.">月·痕</a><p class="description">一个野生码农的留痕</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Optional使用介绍</h1><div class="post-meta">Apr 3, 2018<span> | </span><span class="category"><a href="/categories/Java/">Java</a></span></div><div class="post-content"><p>在日常开发中，<code>NullPointException</code>一直是困扰我已久的问题，如果只是简单对象的判空还好，只需要<code>obj != null</code>就可以解决；但是对象嵌套了多层属性，这个时候需要取里面属性进行判空就很麻烦，代码又长又难看。而Java8中新加的Optional正好可以解决这一问题，让我们在多层属性对象判空时也能写出优雅代码。下面来看看一些用法：<a id="more"></a></p>
<h3 id="构造方法-Optional-of、Optional-ofNullable"><a href="#构造方法-Optional-of、Optional-ofNullable" class="headerlink" title="构造方法 Optional.of、Optional.ofNullable"></a>构造方法 Optional.of、Optional.ofNullable</h3><p><code>of</code>、<code>ofNullable</code>都接收一个对象入参，区别在于of只接收非null对象，当传入的对象为null时，会抛出<code>NullPointException</code>；而ofNullable能null，当入参为null时，为Optional.empty()。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional optional = Optional.of(<span class="number">10L</span>);</span><br><span class="line">Optional optionalNull = Optional.ofNullable(<span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>
<h3 id="实例方法"><a href="#实例方法" class="headerlink" title="实例方法"></a>实例方法</h3><ul>
<li>get  —获取<code>Optional</code>中对象，当对象为null时，抛出<code>NoSuchElementException</code></li>
<li>isPresent  —判断<code>Optional</code>中对象是否为null，返回为boolean</li>
<li>ifPresent  —该方法入参为<code>Consumer</code>，若<code>Optional</code>有值，则调用<code>Consumer</code>；否则不处理</li>
<li>filter  —调用该方法会筛选出符合传入条件的实例，若不符合则返回<code>empty()</code></li>
<li>map  —若实例有值，则返回传入函数处理后的值，否则返回<code>empty()</code></li>
<li>flatmap  —效果与<code>map</code>类似，不同的是返回值必须为用<code>Optional</code>封装后的实例</li>
<li>orElse  —当<code>Optional</code>实例为null，返回传入实例</li>
<li>orElseGet  —当<code>Optional</code>实例为null，返回传入构造方式创建的实例</li>
<li>orElseThrow  —当<code>Optional</code>实例为null，抛出传入构造方式创建的异常<br>以下代码片段则为这些实例方法的部分使用场景</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//get</span></span><br><span class="line">User user = Optional.ofNullable(getById(id)).get();</span><br><span class="line"><span class="comment">//isPresent</span></span><br><span class="line">Optional optional = Optional.ofNullable(getById(id));</span><br><span class="line"><span class="keyword">if</span> (optional.isPresent()) &#123;</span><br><span class="line">    <span class="keyword">return</span> optional.get();</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">"tom"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ifPresent</span></span><br><span class="line">Optional.ofNullable(<span class="keyword">new</span> User(<span class="string">"tom"</span>)).ifPresent(user -&gt; System.out.println(user.getName())); <span class="comment">//tom</span></span><br><span class="line"><span class="comment">//filter</span></span><br><span class="line">Optional.ofNullable(<span class="keyword">new</span> User(<span class="string">"tom"</span>)).filter(user -&gt; <span class="string">"mini"</span>.equals(user.getName()));</span><br><span class="line"><span class="comment">//map</span></span><br><span class="line">String name = Optional.ofNullable(<span class="keyword">new</span> User(<span class="string">"tom"</span>)).map(User::getName).get(); <span class="comment">//tom</span></span><br><span class="line"><span class="comment">//flatmap</span></span><br><span class="line">String name = Optional.ofNullable(<span class="keyword">new</span> User(<span class="string">"tom"</span>)).flatMap(user -&gt; Optional.ofNullable(user.getName())).get(); <span class="comment">//tom</span></span><br><span class="line"><span class="comment">//orElse</span></span><br><span class="line">System.out.println(Optional.ofNullable(<span class="keyword">null</span>).orElse(<span class="number">1L</span>)); <span class="comment">//1</span></span><br><span class="line"><span class="comment">//orElseGet</span></span><br><span class="line">User user = (User) Optional.ofNullable(<span class="keyword">null</span>).orElseGet(User::<span class="keyword">new</span>);</span><br><span class="line"><span class="comment">//orElseThrow</span></span><br><span class="line">Optional.ofNullable(<span class="keyword">null</span>).orElseThrow(BusinessException::<span class="keyword">new</span>); <span class="comment">//throw BusinessException</span></span><br></pre></td></tr></table></figure>
<h3 id="日常使用"><a href="#日常使用" class="headerlink" title="日常使用"></a>日常使用</h3><p>从上面我们已经了解到<code>Optional</code>各个实例方法的使用方法，回过头来看篇头提到的多层属性对象的判空问题上，例如我们有以下一段代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">User user = getById(id);</span><br><span class="line"><span class="keyword">if</span> (user != <span class="keyword">null</span>) &#123;</span><br><span class="line">    Scores scores = user.getScores();</span><br><span class="line">    <span class="keyword">if</span> (scores != <span class="keyword">null</span>) &#123;</span><br><span class="line">        System.out.println(scores.getMath());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到当我们需要使用<code>User</code>中的<code>MenuList</code>时，需要对<code>user</code>、<code>menuList</code>、<code>menu</code>分别判空，我们如何能够使用<code>Optional</code>让代码变得简洁、易懂呢？接下来我们来改写下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;User&gt; optional = Optional.ofNullable(getById(id));</span><br><span class="line">optional.map(user -&gt; user.getScores()).map(scores -&gt; scores.getMath()).ifPresent(System.out::println);</span><br></pre></td></tr></table></figure>
<p>当然上面展示的只是<code>Optional</code>的基本用法，还有很多有趣的用法能够在代码中用到，留给后续慢慢体会吧。</p>
</div><div class="tags"><a href="/tags/Java8/">Java8</a></div><div class="post-nav"><a class="pre" href="/2018/04/04/Intellij-IDEA常用插件/">Intellij IDEA常用插件</a><a class="next" href="/2018/03/28/Element ui + Vue.Draggable实现拖拽排序/">element ui + Vue.Draggable实现拖拽排序</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://bolg.yhen.me"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂文/">杂文</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/element-ui/" style="font-size: 15px;">element-ui</a> <a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/Intellij-IDEA/" style="font-size: 15px;">Intellij IDEA</a> <a href="/tags/Java8/" style="font-size: 15px;">Java8</a> <a href="/tags/selenium/" style="font-size: 15px;">selenium</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/07/11/selenium driver与浏览器版本对应关系/">selenium driver与浏览器版本对应关系</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/04/Intellij-IDEA常用插件/">Intellij IDEA常用插件</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/03/Optional使用介绍/">Optional使用介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/28/Element ui + Vue.Draggable实现拖拽排序/">element ui + Vue.Draggable实现拖拽排序</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/23/开篇博客/">开篇博客</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">月·痕.</a> Powered by<a rel="nofollow" target="_blank" href="http://blog.yhen.me"> yhen.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>